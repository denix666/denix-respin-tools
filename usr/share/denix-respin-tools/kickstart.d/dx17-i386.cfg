install
lang en_US.UTF-8
keyboard us
timezone --utc Europe/Vilnius
firewall --service=ssh
network --onboot yes

repo --name=fedora --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-17&arch=i386
repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f17&arch=i386
repo --name=denix-x --baseurl=http://fedora.os.vc/yum/base/x1/i386
repo --name=mate-desktop --baseurl=http://dl.dropbox.com/u/49862637/Mate-desktop/mate-desktop-fedora/
repo --name=mate-desktop-updates --baseurl=http://dl.dropbox.com/u/49862637/Mate-desktop/mate-desktop-fedora-updates/
repo --name=rpmfusion-free --mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-fedora-17&arch=i386
repo --name=rpmfusion-free-updates --mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-fedora-updates-released-17&arch=i386
repo --name=rpmfusion-nonfree --mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-fedora-17&arch=i386
repo --name=rpmfusion-nonfree-updates --mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-fedora-updates-released-17&arch=i386
repo --name=google-chrome --baseurl=http://dl.google.com/linux/rpm/stable/i386
repo --name=google-talkplugin --baseurl=http://dl.google.com/linux/talkplugin/rpm/stable/i386


############################################################################
%packages ##################################################################
############################################################################

# Base packages
#####################################
@core
@base-x
@hardware-support
@printing

# Mate desktop
#####################################
@mate-desktop

# Maintenance utils
#####################################
grub2
mc
dracut
bash-completion

# Fonts
#####################################
@fonts
@legacy-fonts

# Themes
#####################################
echo-icon-theme
gnome-icon-theme-symbolic

# Denix stuff
#####################################
denix-x-repo
denix-skel
denix-sounds
denix-backgrounds
denix-prompt
denix-umask
denix-colors
denix-themes
denix-bash

# Not needed
######################################
-abrt*
-kernel*debug*
-kernel-devel
-fedora-release-notes
-sendmail
-atril*

############################################################################
%end #######################################################################
############################################################################

############################################################################
%post ######################################################################
############################################################################

# Disable SELinux
#################
sed -i 's/^SELINUX=.*$/SELINUX=disabled/g' /etc/selinux/config
setenforce 0

# Edit login.defs
#################
sed -i 's/^UID_MIN.*$/UID_MIN			1000/g' /etc/login.defs
sed -i 's/^GID_MIN.*$/GID_MIN			1000/g' /etc/login.defs

# Add skype repo
################
cat > /etc/yum.repos.d/skype.repo << EOF_SKYPE_REPO
[skype]
name=Skype Repository
baseurl=http://download.skype.com/linux/repos/fedora/updates/i586/
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-skype
enabled=1
skip_if_unavailable=1
EOF_SKYPE_REPO

# Add VirtualBox repo
#####################
cat > /etc/yum.repos.d/virtualbox.repo << EOF_VIRTUALBOX_REPO
[virtualbox]
name=Fedora \$releasever - \$basearch - VirtualBox
baseurl=http://download.virtualbox.org/virtualbox/rpm/fedora/\$releasever/\$basearch
enabled=1
gpgcheck=1
gpgkey=http://download.virtualbox.org/virtualbox/debian/oracle_vbox.asc
skip_if_unavailable=1
EOF_VIRTUALBOX_REPO

# Add issue message
###################
cat > /etc/issue << EOF_ISSUE
Welcome to DeniX
~~~~~~~~~~~~~~~~

EOF_ISSUE

# Edit SSH properties
#####################
sed -i 's/#Protocol 2/Protocol 2/g' /etc/ssh/sshd_config
echo "ServerAliveInterval 100" >> /etc/ssh/ssh_config
sed -i 's/^#Banner.*$/Banner \/etc\/issue/g' /etc/ssh/sshd_config

# Disable root mail notifications
#################################
echo "root:		/dev/null" >> /etc/aliases
newaliases >/dev/null

# History search
################
cat >> /etc/inputrc << EOF_INPUTRC
"\e[A": history-search-backward
"\e[B": history-search-forward
EOF_INPUTRC

# Console appearance
####################
gconftool-2 --direct --config-source=xml:readwrite:/etc/gconf/gconf.xml.defaults -s -t string /apps/gnome-terminal/profiles/Default/background_color "#000000000000" >/dev/null
gconftool-2 --direct --config-source=xml:readwrite:/etc/gconf/gconf.xml.defaults -s -t string /apps/gnome-terminal/profiles/Default/foreground_color "#886FEA6E9D98" >/dev/null
gconftool-2 --direct --config-source=xml:readwrite:/etc/gconf/gconf.xml.defaults -s -t string /apps/gnome-terminal/profiles/Default/background_darkness "0.9" >/dev/null
gconftool-2 --direct --config-source=xml:readwrite:/etc/gconf/gconf.xml.defaults -s -t bool /apps/gnome-terminal/profiles/Default/use_theme_colors false >/dev/null
gconftool-2 --direct --config-source=xml:readwrite:/etc/gconf/gconf.xml.defaults -s -t bool /apps/gnome-terminal/global/use_menu_accelerators false >/dev/null


# MC brief mode for root
########################
install -m 0700 -d /root/.cache/mc
cat > /root/.cache/mc/panels.ini << EOF_MC_ROOT
[New Left Panel]
list_mode=brief
[New Right Panel]
list_mode=brief
EOF_MC_ROOT
chmod 600 /root/.mc/panels.ini

# Add public key for root authorization
#######################################
install -m 0700 -d /root/.ssh
cat > /root/.ssh/authorized_keys << EOF_SSH
EOF_SSH
chmod 600 /root/.ssh/authorized_keys

############################################################################
%end #######################################################################
############################################################################
