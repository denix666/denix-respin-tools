install
auth --enableshadow --passalgo=sha512
lang en_US.UTF-8
keyboard us
timezone Europe/Vilnius --isUtc
firewall --service=ssh
selinux --disabled
network --onboot yes --hostname denix.os

clearpart --all --initlabel
autopart

repo --name=fedora --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-18&arch=i386
repo --name=updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f18&arch=i386
repo --name=denix-x --baseurl=http://fedora.os.vc/yum/base/x1/i386
repo --name=google-chrome --baseurl=http://dl.google.com/linux/chrome/rpm/stable/i386/
repo --name=google-talkplugin --baseurl=http://dl.google.com/linux/talkplugin/rpm/stable/i386
repo --name=adobe-linux --baseurl=http://linuxdownload.adobe.com/linux/i386/
repo --name=rpmfusion-free --mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-fedora-18&arch=i386
repo --name=rpmfusion-free-updates --mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=free-fedora-updates-released-18&arch=i386
repo --name=rpmfusion-nonfree --mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-fedora-18&arch=i386
repo --name=rpmfusion-nonfree-updates --mirrorlist=http://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-fedora-updates-released-18&arch=i386


############################################################################
%packages --excludedocs --nobase ###########################################
############################################################################

# Base packages
#####################################
@core
@base-x
@hardware-support
@printing
@admin-tools
@sound-and-video
@system-tools
@dial-up
generic-logos
generic-release-notes

# KDE desktop
#####################################
@kde-desktop

# Maintenance utils
#####################################
grub2
bash
mc
dracut
bash-completion
system-config-lvm
mcrypt
firewalld
authconfig
beesu
htop
isomaster
nrg2iso
engine_pkcs11
uniconvertor
gnupg2-smime
net-tools

# Fonts
#####################################
@fonts
@legacy-fonts

# Office
#####################################
libreoffice-writer
libreoffice-calc
libreoffice-impress

# Internet
#####################################
thunderbird
thunderbird-enigmail
fetchmail
google-chrome-stable
google-talkplugin
rdesktop
skype
mail-notification

# Sound and multimedia
#####################################
vlc
cheese
mpg321
libmpeg3
id3lib
ffmpeg
gstreamer-ffmpeg
gstreamer-plugins-bad
gstreamer-plugins-bad-nonfree
lame
flash-plugin

# Virtualisation
#####################################
wine*
qemu

# Security Lab
#####################################
john
hping3
p0f
arp-scan
macchanger
nmbscan
tcpdump
ngrep
ncrack
iftop
nmap

# Programming
#####################################
geany
gcc-c++
gcc
dkms
rpmdevtools
git
ghex
PyQt4

# Themes
#####################################
echo-icon-theme
fedora-icon-theme
plymouth-theme-solar

# Archive tools
#####################################
rar
unrar
cabextract
p7zip

# Graphics
#####################################
gimp
shotwell
inkscape

# Denix stuff
#####################################
denix-x-repo
denix-skel
denix-sounds
denix-backgrounds
denix-prompt
denix-umask
denix-colors
denix-icons
denix-bash
denix-grub2-theme
system-setup-tools

# Server packages
#####################################
bind
dhcp
samba
proftpd
denyhosts
postfix
mysql-server
httpd
php
php-pear
php-mysql
php-mbstring
ntp
sysstat

# Not needed
######################################
-abrt*
-kernel*debug*
-kernel-devel
-fedora-release-notes
-sendmail
-AdobeReader*
-xterm
-sysreport

############################################################################
%end #######################################################################
############################################################################

############################################################################
%post ######################################################################
############################################################################

# Disable SELinux
#################
sed -i 's/^SELINUX=.*$/SELINUX=disabled/g' /etc/selinux/config
setenforce 0

# Add rc.local compatibility
############################
echo "#! /bin/bash" > /etc/rc.d/rc.local
chmod 755 /etc/rc.d/rc.local

# Add console colors
####################
cat >> /etc/rc.d/rc.local << EOF_CONSOLE_COLORS
for i in /dev/tty[0-9]*; do
    echo -en "\\\033[1;32m\\\033[8]" > \$i
    echo -en "\033[9;0]" > \$i
done
EOF_CONSOLE_COLORS

# Fix grub2 options
###################
cat >> /etc/default/grub << EOF_GRUB
GRUB_THEME="/boot/grub2/themes/denix/theme.txt"
EOF_GRUB
grub2-mkconfig -o /boot/grub2/grub.cfg

# Swith to solar plymouth theme
###############################
plymouth-set-default-theme solar -R

# Edit login.defs
#################
sed -i 's/^UID_MIN.*$/UID_MIN			1000/g' /etc/login.defs
sed -i 's/^GID_MIN.*$/GID_MIN			1000/g' /etc/login.defs

# Add adobe repo
################
cat > /etc/yum.repos.d/adobe-linux.repo << EOF_ADOBE_REPO
[adobe-linux]
name=Adobe Systems Incorporated
baseurl=http://linuxdownload.adobe.com/linux/i386/
enabled=0
gpgcheck=0
EOF_ADOBE_REPO

# Add VirtualBox repo
#####################
cat > /etc/yum.repos.d/virtualbox.repo << EOF_VIRTUALBOX_REPO
[virtualbox]
name=Fedora \$releasever - \$basearch - VirtualBox
baseurl=http://download.virtualbox.org/virtualbox/rpm/fedora/\$releasever/\$basearch
enabled=0
gpgcheck=1
gpgkey=http://download.virtualbox.org/virtualbox/debian/oracle_vbox.asc
skip_if_unavailable=1
EOF_VIRTUALBOX_REPO

# Add issue message
###################
cat > /etc/issue << EOF_ISSUE
Welcome to DeniX-OS
~~~~~~~~~~~~~~~~~~~

EOF_ISSUE

# Edit SSH properties
#####################
sed -i 's/#Protocol 2/Protocol 2/g' /etc/ssh/sshd_config
echo "ServerAliveInterval 100" >> /etc/ssh/ssh_config
sed -i 's/^#Banner.*$/Banner \/etc\/issue/g' /etc/ssh/sshd_config

# Disable root mail notifications
#################################
echo "root:		/dev/null" >> /etc/aliases
newaliases >/dev/null

# History search
################
cat >> /etc/inputrc << EOF_INPUTRC
"\e[A": history-search-backward
"\e[B": history-search-forward
EOF_INPUTRC

# MC brief mode for root
########################
install -m 0700 -d /root/.cache/mc
cat > /root/.cache/mc/panels.ini << EOF_MC_ROOT
[New Left Panel]
list_mode=brief
[New Right Panel]
list_mode=brief
EOF_MC_ROOT
chmod 600 /root/.cache/mc/panels.ini

# Add public key for root authorization
#######################################
install -m 0700 -d /root/.ssh
cat > /root/.ssh/authorized_keys << EOF_SSH
EOF_SSH
chmod 600 /root/.ssh/authorized_keys

# Make oxygen-gtk the default GTK+ theme for root
#################################################
cat > /root/.gtkrc-2.0 << EOF_GTK2
include "/usr/share/themes/oxygen-gtk/gtk-2.0/gtkrc"
include "/etc/gtk-2.0/gtkrc"
gtk-theme-name="oxygen-gtk"
EOF_GTK2

mkdir -p /root/.config/gtk-3.0
cat > /root/.config/gtk-3.0/settings.ini << EOF_GTK3
[Settings]
gtk-theme-name = oxygen-gtk
EOF_GTK3

# Set kde-globals X-REMOVE-X
#################
mkdir -p /etc/skel/.kde/share/config
cat > /etc/skel/.kde/share/config/kdeglobals << KDEGLOBALS_EOF
[General]
BrowserApplication=google-chrome.desktop
ColorScheme=Default
XftAntialias=true
XftHintStyle=hintslight
XftSubPixel=rgb
desktopFont=Liberation Sans,10,-1,5,50,0,0,0,0,0
fixed=Liberation Mono,10,-1,5,50,0,0,0,0,0
font=Liberation Sans,10,-1,5,50,0,0,0,0,0
menuFont=Liberation Sans,10,-1,5,50,0,0,0,0,0
shadeSortColumn=true
smallestReadableFont=Liberation Sans,10,-1,5,50,0,0,0,0,0
taskbarFont=Liberation Sans,10,-1,5,50,0,0,0,0,0
toolBarFont=Liberation Sans,10,-1,5,50,0,0,0,0,0
widgetStyle=oxygen

[Icons]
Theme=Sonar

[KDE]
AutoSelectDelay=-1
ChangeCursor=true
DoubleClickInterval=400
ShowIconsInMenuItems=true
ShowIconsOnPushButtons=true
SingleClick=false
StartDragDist=4
StartDragTime=500
WheelScrollLines=3
contrast=5
KDEGLOBALS_EOF

# Set keyboard layouts X-REMOVE-X
######################
mkdir -p /etc/skel/.kde/share/config
cat > /etc/skel/.kde/share/config/kxkbrc << KXKBRC_EOF
[Layout]
DisplayNames=,
LayoutList=us,ru(phonetic)
LayoutLoopCount=-1
Model=pc101
Options=grp:alt_shift_toggle
ResetOldOptions=true
ShowFlag=true
ShowLabel=false
ShowLayoutIndicator=true
ShowSingle=true
SwitchMode=WinClass
Use=true
KXKBRC_EOF

# Set akonadi backend X-REMOVE-X
#####################
mkdir -p /etc/skel/.config/akonadi
cat > /etc/skel/.config/akonadi/akonadiserverrc << AKONADI_EOF
[%General]
Driver=QSQLITE3
AKONADI_EOF

# Disable the update notifications of apper X-REMOVE-X
###########################################
mkdir -p /etc/skel/.kde/share/config
cat > /etc/skel/.kde/share/config/apper << APPER_EOF
[CheckUpdate]
autoUpdate=0
interval=0
APPER_EOF

# Disable nepomuk X-REMOVE-X
#################
mkdir -p /etc/skel/.kde/share/config
cat > /etc/skel/.kde/share/config/nepomukserverrc << NEPOMUK_EOF
[Basic Settings]
Start Nepomuk=false

[Service-nepomukstrigiservice]
autostart=false
NEPOMUK_EOF

# Anaconda fix (temporary)
##########################
grub2-install /dev/sda

############################################################################
%end #######################################################################
############################################################################
